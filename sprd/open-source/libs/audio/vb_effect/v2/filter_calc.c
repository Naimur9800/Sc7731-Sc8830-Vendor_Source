/*
 * Copyright (C) 2012 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**---------------------------------------------------------------------------*
 **                         Dependencies                                      *
 **---------------------------------------------------------------------------*/


#include "filter_calc.h"

#include <stdlib.h>
#include <errno.h>

/**---------------------------------------------------------------------------*
 **                         Compiler Flag                                     *
 **---------------------------------------------------------------------------*/
#ifdef   __cplusplus
    extern   "C"
    {
#endif
/**---------------------------------------------------------------------------*
 **                         Macro Definition                                  *
 **---------------------------------------------------------------------------*/
 #define TRUE		SCI_TRUE
 #define FALSE	SCI_FALSE
 #define EQ_SCALE_FACTOR 0//0,1,2,3,
 #define abso(x)   ( ((x) > 0) ? (x) : -(x) )
 //#define max(a, b) (((a) > (b)) ? (a) : (b))
/**---------------------------------------------------------------------------*
 **                         const tables                                  *
 **---------------------------------------------------------------------------*/

 LOCAL CONST int16_t Linear_gain_Table[1801] ={//4096πÈ“ªªØ
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
	2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
	3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
	3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
	5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,
	6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,
	8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,
	10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,
	12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,
	14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,
	16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,
	20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,
	24,24,24,24,24,24,24,25,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,28,28,28,28,28,28,28,
	29,29,29,29,29,30,30,30,30,30,30,31,31,31,31,31,31,32,32,32,32,32,33,33,33,33,33,34,34,34,34,34,35,35,35,
	35,35,36,36,36,36,36,37,37,37,37,38,38,38,38,38,39,39,39,39,40,40,40,40,40,41,41,41,41,42,42,42,42,43,43,43,
	43,44,44,44,44,45,45,45,45,46,46,46,47,47,47,47,48,48,48,48,49,49,49,50,50,50,50,51,51,51,52,52,52,53,53,53,53,
	54,54,54,55,55,55,56,56,56,57,57,57,58,58,58,59,59,59,60,60,60,61,61,61,62,62,63,63,63,64,64,64,65,65,66,66,66,67,67,
	67,68,68,69,69,69,70,70,71,71,72,72,72,73,73,74,74,74,75,75,76,76,77,77,78,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85,
	86,86,87,87,88,88,89,89,90,90,91,91,92,92,93,93,94,94,95,96,96,97,97,98,98,99,99,100,101,101,102,102,103,104,104,105,105,106,
	107,107,108,108,109,110,110,111,112,112,113,114,114,115,116,116,117,118,118,119,120,120,121,122,122,123,124,125,125,126,127,128,128,
	129,130,131,131,132,133,134,134,135,136,137,137,138,139,140,141,142,142,143,144,145,146,147,147,148,149,150,151,152,153,153,154,155,156,157,
	158,159,160,161,162,163,164,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,184,185,186,187,188,189,190,191,192,193,194,196,
	197,198,199,200,201,202,204,205,206,207,208,210,211,212,213,214,216,217,218,219,221,222,223,225,226,227,229,230,231,233,234,235,237,238,239,241,242,243,
	245,246,248,249,251,252,254,255,256,258,259,261,262,264,265,267,269,270,272,273,275,276,278,280,281,283,285,286,288,289,291,293,295,296,298,300,301,303,305,307,308,
	310,312,314,316,317,319,321,323,325,327,329,331,332,334,336,338,340,342,344,346,348,350,352,354,356,358,360,362,365,367,369,371,373,375,377,380,382,384,386,388,391,393,395,397,
	400,402,404,407,409,411,414,416,419,421,423,426,428,431,433,436,438,441,443,446,449,451,454,456,459,462,464,467,470,472,475,478,481,484,486,489,492,495,498,501,503,506,509,512,515,518,521,
	524,527,530,533,536,539,543,546,549,552,555,558,562,565,568,571,575,578,581,585,588,592,595,598,602,605,609,612,616,619,623,627,630,634,638,641,645,649,652,656,660,664,668,
	671,675,679,683,687,691,695,699,703,707,711,715,720,724,728,732,736,741,745,749,753,758,762,767,771,775,780,784,789,794,798,803,807,812,817,821,826,831,836,841,845,850,855,860,865,870,875,
	880,885,890,896,901,906,911,916,922,927,932,938,943,949,954,960,965,971,976,982,988,993,999,1005,1011,1017,1022,1028,1034,1040,1046,1052,1058,1065,1071,1077,1083,1089,1096,1102,1108,1115,1121,1128,1134,
	1141,1147,1154,1161,1167,1174,1181,1188,
	1194,1201,1208,1215,1222,1229,1236,1244,1251,1258,1265,1273,1280,1287,1295,1302,
	1310,1317,1325,1333,1340,1348,1356,1364,1372,1379,1387,1395,1403,1412,1420,1428,
	1436,1444,1453,1461,1470,1478,1487,1495,1504,1513,1521,1530,1539,1548,1557,1566,1575,1584,1593,1602,1611,1621,1630,1640,1649,1659,1668,1678,1687,1697,1707,1717,1727,1737,
	1747,1757,1767,1777,1787,1798,1808,1819,1829,1840,1850,1861,1872,1883,1893,1904,
	1915,1926,1938,1949,1960,1971,1983,1994,2006,2017,2029,2041,2052,2064,2076,2088,
	2100,2112,2125,2137,2149,2162,2174,2187,2199,2212,2225,2237,2250,2263,2276,2290,
	2303,2316,2330,2343,2357,2370,2384,2398,2411,2425,2439,2453,2468,2482,2496,2511,
	2525,2540,2554,2569,2584,2599,2614,2629,2644,2659,2675,2690,2706,2721,2737,2753,
	2769,2785,2801,2817,2833,2850,2866,2883,2899,2916,2933,2950,2967,2984,3001,3018,
	3036,3053,3071,3089,3107,3125,3143,3161,3179,3197,3216,3234,3253,3272,3291,3310,
	3329,3348,3367,3387,3406,3426,3446,3466,3486,3506,3526,3546,3567,3588,3608,3629,
	3650,3671,3692,3714,3735,3757,3778,3800,3822,3844,3866,3889,3911,3934,3956,3979,
	4002,4025,4049,4072,4096,4119,4143,4167,4191,4215,4239,4264,4289,4313,4338,4363,
	4388,4414,4439,4465,4491,4517,4543,4569,4595,4622,4649,4675,4702,4729,4757,4784,
	4812,4840,4868,4896,4924,4952,4981,5010,5039,5068,5097,5126,5156,5186,5216,5246,
	5276,5307,5337,5368,5399,5430,5462,5493,5525,5557,5589,5621,5654,5686,5719,5752,
	5785,5819,5852,5886,5920,5954,5989,6023,6058,6093,6128,6163,6199,6235,6271,6307,
	6343,6380,6417,6454,6491,6529,6566,6604,6642,6681,6719,6758,6797,6836,6876,6916,
	6956,6996,7036,7077,7118,7159,7200,7242,7283,7325,7368,7410,7453,7496,7539,7583,
	7627,7671,7715,7759,7804,7849,7895,7940,7986,8032,8079,8125,8172,8219,8267,8314,
	8362,8411,8459,8508,8557,8607,8656,8706,8757,8807,8858,8909,8961,9012,9064,9117,
	9169,9222,9275,9329,9383,9437,9492,9546,9601,9657,9713,9769,9825,9882,9939,9996,
	10054,10112,10170,10229,10288,10348,10407,10467,10528,10589,10650,10711,10773,
	10835,10898,10961,11024,11088,11152,11216,11281,11346,11411,11477,11544,11610,
	11677,11745,11812,11881,11949,12018,12088,12157,12228,12298,12369,12441,12512,
	12585,12657,12730,12804,12878,12952,13027,13102,13178,13254,13330,13407,13485,13563,13641,13720,13799,13879,13959,14039,14120,14202,14284,14366,14449,14533,14617,14701,14786,14871,14957,15043,15130,15218,15305,15394,15483,15572,15662,15752,15843,15935,16027,16119,16212,16306,16400,
	16495,16590,16686,16782,16879,16976,17074,17173,17272,17372,17472,17573,17675,
	17777,17879,17982,18086,18191,18296,18401,18508,18614,18722,18830,18939,19048,
	19158,19269,19380,19492,19604,19717,19831,19946,20061,20177,20293,20410,20528,
	20647,20766,20886,21006,21128,21250,21372,21496,21620,21745,21870,21996,22123,
	22251,22379,22509,22639,22769,22901,23033,23166,23300,23434,23570,23706,23842,
	23980,24119,24258,24398,24539,24680,24823,24966,25110,25255,25401,25548,25695,
	25844,25993,26143,26294,26445,26598,26752,26906,27062,27218,27375,27533,27692,27852,28013,28174,28337,28500,28665,28831,28997,29164,29333,29502,29672,29844,30016,30189,30364,30539,30715,30892,31071,31250,31431,31612,31795,31978,32163,32348,32535

 } ;



LOCAL CONST int16_t cos_Table[2049] = {
    16384,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16382,16382,16382,16382,16382,16382,16381,16381,16381,16381,16380,16380,16380,16380,16379,16379,16379,
    16379,16378,16378,16378,16377,16377,16377,16376,16376,16375,16375,16375,16374,16374,16373,16373,16372,16372,16371,16371,16370,16370,16369,16369,16368,16368,16367,16367,16366,16366,16365,16364,
    16364,16363,16363,16362,16361,16361,16360,16359,16359,16358,16357,16356,16356,16355,16354,16353,16353,16352,16351,16350,16350,16349,16348,16347,16346,16345,16344,16344,16343,16342,16341,16340,
    16339,16338,16337,16336,16335,16334,16333,16332,16331,16330,16329,16328,16327,16326,16325,16324,16323,16322,16321,16320,16319,16318,16316,16315,16314,16313,16312,16311,16309,16308,16307,16306,
    16305,16303,16302,16301,16300,16298,16297,16296,16294,16293,16292,16290,16289,16288,16286,16285,16284,16282,16281,16279,16278,16277,16275,16274,16272,16271,16269,16268,16266,16265,16263,16262,
    16260,16259,16257,16256,16254,16252,16251,16249,16248,16246,16244,16243,16241,16239,16238,16236,16234,16233,16231,16229,16228,16226,16224,16222,16221,16219,16217,16215,16213,16212,16210,16208,
    16206,16204,16202,16201,16199,16197,16195,16193,16191,16189,16187,16185,16183,16181,16179,16177,16175,16173,16171,16169,16167,16165,16163,16161,16159,16157,16155,16153,16151,16149,16147,16144,
    16142,16140,16138,16136,16134,16131,16129,16127,16125,16123,16120,16118,16116,16114,16111,16109,16107,16104,16102,16100,16097,16095,16093,16090,16088,16086,16083,16081,16078,16076,16074,16071,
    16069,16066,16064,16061,16059,16056,16054,16051,16049,16046,16044,16041,16039,16036,16033,16031,16028,16026,16023,16020,16018,16015,16012,16010,16007,16004,16002,15999,15996,15994,15991,15988,
    15985,15983,15980,15977,15974,15972,15969,15966,15963,15960,15957,15955,15952,15949,15946,15943,15940,15937,15934,15931,15928,15926,15923,15920,15917,15914,15911,15908,15905,15902,15899,15896,
    15892,15889,15886,15883,15880,15877,15874,15871,15868,15865,15861,15858,15855,15852,15849,15846,15842,15839,15836,15833,15830,15826,15823,15820,15817,15813,15810,15807,15803,15800,15797,15793,
    15790,15787,15783,15780,15777,15773,15770,15766,15763,15759,15756,15753,15749,15746,15742,15739,15735,15732,15728,15725,15721,15718,15714,15710,15707,15703,15700,15696,15693,15689,15685,15682,
    15678,15674,15671,15667,15663,15660,15656,15652,15649,15645,15641,15637,15634,15630,15626,15622,15618,15615,15611,15607,15603,15599,15596,15592,15588,15584,15580,15576,15572,15568,15564,15561,
    15557,15553,15549,15545,15541,15537,15533,15529,15525,15521,15517,15513,15509,15505,15500,15496,15492,15488,15484,15480,15476,15472,15468,15463,15459,15455,15451,15447,15443,15438,15434,15430,
    15426,15422,15417,15413,15409,15404,15400,15396,15392,15387,15383,15379,15374,15370,15366,15361,15357,15352,15348,15344,15339,15335,15330,15326,15322,15317,15313,15308,15304,15299,15295,15290,
    15286,15281,15277,15272,15267,15263,15258,15254,15249,15245,15240,15235,15231,15226,15221,15217,15212,15207,15203,15198,15193,15189,15184,15179,15175,15170,15165,15160,15156,15151,15146,15141,
    15136,15132,15127,15122,15117,15112,15107,15102,15098,15093,15088,15083,15078,15073,15068,15063,15058,15053,15048,15043,15038,15033,15028,15023,15018,15013,15008,15003,14998,14993,14988,14983,
    14978,14973,14968,14963,14957,14952,14947,14942,14937,14932,14927,14921,14916,14911,14906,14901,14895,14890,14885,14880,14874,14869,14864,14858,14853,14848,14843,14837,14832,14827,14821,14816,
    14810,14805,14800,14794,14789,14783,14778,14773,14767,14762,14756,14751,14745,14740,14734,14729,14723,14718,14712,14707,14701,14696,14690,14685,14679,14673,14668,14662,14657,14651,14645,14640,
    14634,14628,14623,14617,14611,14606,14600,14594,14589,14583,14577,14571,14566,14560,14554,14548,14543,14537,14531,14525,14519,14514,14508,14502,14496,14490,14484,14478,14473,14467,14461,14455,
    14449,14443,14437,14431,14425,14419,14413,14407,14401,14395,14389,14383,14377,14371,14365,14359,14353,14347,14341,14335,14329,14323,14317,14310,14304,14298,14292,14286,14280,14274,14267,14261,
    14255,14249,14243,14236,14230,14224,14218,14211,14205,14199,14193,14186,14180,14174,14167,14161,14155,14148,14142,14136,14129,14123,14117,14110,14104,14098,14091,14085,14078,14072,14065,14059,
    14053,14046,14040,14033,14027,14020,14014,14007,14001,13994,13988,13981,13974,13968,13961,13955,13948,13942,13935,13928,13922,13915,13908,13902,13895,13888,13882,13875,13868,13862,13855,13848,
    13842,13835,13828,13821,13815,13808,13801,13794,13788,13781,13774,13767,13760,13753,13747,13740,13733,13726,13719,13712,13705,13699,13692,13685,13678,13671,13664,13657,13650,13643,13636,13629,
    13622,13615,13608,13601,13594,13587,13580,13573,13566,13559,13552,13545,13538,13531,13524,13517,13510,13502,13495,13488,13481,13474,13467,13460,13452,13445,13438,13431,13424,13416,13409,13402,
    13395,13388,13380,13373,13366,13359,13351,13344,13337,13329,13322,13315,13307,13300,13293,13285,13278,13271,13263,13256,13249,13241,13234,13226,13219,13211,13204,13197,13189,13182,13174,13167,
    13159,13152,13144,13137,13129,13122,13114,13107,13099,13092,13084,13076,13069,13061,13054,13046,13038,13031,13023,13016,13008,13000,12993,12985,12977,12970,12962,12954,12947,12939,12931,12923,
    12916,12908,12900,12893,12885,12877,12869,12861,12854,12846,12838,12830,12822,12815,12807,12799,12791,12783,12775,12768,12760,12752,12744,12736,12728,12720,12712,12704,12696,12688,12680,12672,
    12665,12657,12649,12641,12633,12625,12617,12609,12600,12592,12584,12576,12568,12560,12552,12544,12536,12528,12520,12512,12504,12495,12487,12479,12471,12463,12455,12447,12438,12430,12422,12414,
    12406,12397,12389,12381,12373,12364,12356,12348,12340,12331,12323,12315,12307,12298,12290,12282,12273,12265,12257,12248,12240,12232,12223,12215,12207,12198,12190,12181,12173,12165,12156,12148,
    12139,12131,12122,12114,12105,12097,12088,12080,12072,12063,12054,12046,12037,12029,12020,12012,12003,11995,11986,11978,11969,11960,11952,11943,11935,11926,11917,11909,11900,11892,11883,11874,
    11866,11857,11848,11840,11831,11822,11813,11805,11796,11787,11779,11770,11761,11752,11744,11735,11726,11717,11708,11700,11691,11682,11673,11664,11656,11647,11638,11629,11620,11611,11602,11594,
    11585,11576,11567,11558,11549,11540,11531,11522,11513,11504,11496,11487,11478,11469,11460,11451,11442,11433,11424,11415,11406,11397,11388,11379,11370,11360,11351,11342,11333,11324,11315,11306,
    11297,11288,11279,11270,11260,11251,11242,11233,11224,11215,11206,11196,11187,11178,11169,11160,11150,11141,11132,11123,11114,11104,11095,11086,11077,11067,11058,11049,11040,11030,11021,11012,
    11002,10993,10984,10974,10965,10956,10946,10937,10928,10918,10909,10900,10890,10881,10871,10862,10853,10843,10834,10824,10815,10805,10796,10786,10777,10768,10758,10749,10739,10730,10720,10711,
    10701,10692,10682,10673,10663,10653,10644,10634,10625,10615,10606,10596,10586,10577,10567,10558,10548,10538,10529,10519,10510,10500,10490,10481,10471,10461,10452,10442,10432,10423,10413,10403,
    10393,10384,10374,10364,10354,10345,10335,10325,10315,10306,10296,10286,10276,10267,10257,10247,10237,10227,10218,10208,10198,10188,10178,10168,10159,10149,10139,10129,10119,10109,10099,10089,
    10079,10070,10060,10050,10040,10030,10020,10010,10000,9990,9980,9970,9960,9950,9940,9930,9920,9910,9900,9890,9880,9870,9860,9850,9840,9830,9820,9810,9800,9790,9780,9770,
    9759,9749,9739,9729,9719,9709,9699,9689,9679,9668,9658,9648,9638,9628,9618,9607,9597,9587,9577,9567,9556,9546,9536,9526,9516,9505,9495,9485,9475,9464,9454,9444,
    9434,9423,9413,9403,9392,9382,9372,9361,9351,9341,9331,9320,9310,9300,9289,9279,9268,9258,9248,9237,9227,9217,9206,9196,9185,9175,9165,9154,9144,9133,9123,9112,
    9102,9092,9081,9071,9060,9050,9039,9029,9018,9008,8997,8987,8976,8966,8955,8945,8934,8924,8913,8902,8892,8881,8871,8860,8850,8839,8829,8818,8807,8797,8786,8776,
    8765,8754,8744,8733,8722,8712,8701,8690,8680,8669,8658,8648,8637,8626,8616,8605,8594,8584,8573,8562,8552,8541,8530,8519,8509,8498,8487,8476,8466,8455,8444,8433,
    8423,8412,8401,8390,8379,8369,8358,8347,8336,8325,8315,8304,8293,8282,8271,8260,8249,8239,8228,8217,8206,8195,8184,8173,8162,8152,8141,8130,8119,8108,8097,8086,
    8075,8064,8053,8042,8031,8020,8009,7998,7988,7977,7966,7955,7944,7933,7922,7911,7900,7889,7878,7867,7856,7844,7833,7822,7811,7800,7789,7778,7767,7756,7745,7734,
    7723,7712,7701,7690,7678,7667,7656,7645,7634,7623,7612,7601,7590,7578,7567,7556,7545,7534,7523,7511,7500,7489,7478,7467,7456,7444,7433,7422,7411,7400,7388,7377,
    7366,7355,7343,7332,7321,7310,7299,7287,7276,7265,7253,7242,7231,7220,7208,7197,7186,7174,7163,7152,7141,7129,7118,7107,7095,7084,7073,7061,7050,7039,7027,7016,
    7005,6993,6982,6970,6959,6948,6936,6925,6914,6902,6891,6879,6868,6857,6845,6834,6822,6811,6799,6788,6777,6765,6754,6742,6731,6719,6708,6696,6685,6673,6662,6650,
    6639,6627,6616,6604,6593,6581,6570,6558,6547,6535,6524,6512,6501,6489,6478,6466,6455,6443,6432,6420,6408,6397,6385,6374,6362,6351,6339,6327,6316,6304,6293,6281,
    6269,6258,6246,6235,6223,6211,6200,6188,6176,6165,6153,6141,6130,6118,6106,6095,6083,6071,6060,6048,6036,6025,6013,6001,5990,5978,5966,5955,5943,5931,5919,5908,
    5896,5884,5873,5861,5849,5837,5826,5814,5802,5790,5779,5767,5755,5743,5732,5720,5708,5696,5684,5673,5661,5649,5637,5625,5614,5602,5590,5578,5566,5555,5543,5531,
    5519,5507,5495,5484,5472,5460,5448,5436,5424,5412,5401,5389,5377,5365,5353,5341,5329,5317,5306,5294,5282,5270,5258,5246,5234,5222,5210,5198,5187,5175,5163,5151,
    5139,5127,5115,5103,5091,5079,5067,5055,5043,5031,5019,5007,4995,4983,4972,4960,4948,4936,4924,4912,4900,4888,4876,4864,4852,4840,4828,4816,4804,4792,4780,4768,
    4756,4743,4731,4719,4707,4695,4683,4671,4659,4647,4635,4623,4611,4599,4587,4575,4563,4551,4539,4527,4514,4502,4490,4478,4466,4454,4442,4430,4418,4406,4394,4381,
    4369,4357,4345,4333,4321,4309,4297,4284,4272,4260,4248,4236,4224,4212,4200,4187,4175,4163,4151,4139,4127,4114,4102,4090,4078,4066,4054,4041,4029,4017,4005,3993,
    3980,3968,3956,3944,3932,3920,3907,3895,3883,3871,3858,3846,3834,3822,3810,3797,3785,3773,3761,3748,3736,3724,3712,3700,3687,3675,3663,3651,3638,3626,3614,3602,
    3589,3577,3565,3552,3540,3528,3516,3503,3491,3479,3467,3454,3442,3430,3417,3405,3393,3381,3368,3356,3344,3331,3319,3307,3294,3282,3270,3257,3245,3233,3221,3208,
    3196,3184,3171,3159,3147,3134,3122,3110,3097,3085,3073,3060,3048,3035,3023,3011,2998,2986,2974,2961,2949,2937,2924,2912,2900,2887,2875,2862,2850,2838,2825,2813,
    2801,2788,2776,2763,2751,2739,2726,2714,2701,2689,2677,2664,2652,2639,2627,2615,2602,2590,2577,2565,2553,2540,2528,2515,2503,2491,2478,2466,2453,2441,2428,2416,
    2404,2391,2379,2366,2354,2341,2329,2316,2304,2292,2279,2267,2254,2242,2229,2217,2204,2192,2180,2167,2155,2142,2130,2117,2105,2092,2080,2067,2055,2042,2030,2018,
    2005,1993,1980,1968,1955,1943,1930,1918,1905,1893,1880,1868,1855,1843,1830,1818,1805,1793,1780,1768,1755,1743,1730,1718,1705,1693,1680,1668,1655,1643,1630,1618,
    1605,1593,1580,1568,1555,1543,1530,1518,1505,1493,1480,1468,1455,1443,1430,1418,1405,1393,1380,1368,1355,1343,1330,1318,1305,1292,1280,1267,1255,1242,1230,1217,
    1205,1192,1180,1167,1155,1142,1130,1117,1105,1092,1079,1067,1054,1042,1029,1017,1004,992,979,967,954,941,929,916,904,891,879,866,854,841,829,816,
    803,791,778,766,753,741,728,716,703,690,678,665,653,640,628,615,603,590,577,565,552,540,527,515,502,490,477,464,452,439,427,414,
    402,389,376,364,351,339,326,314,301,289,276,263,251,238,226,213,201,188,175,163,150,138,125,113,100,87,75,62,50,37,25,12,0};



LOCAL CONST int16_t GTable[901] = {//%4096πÈ“ªªØ
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,
    2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
    2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,
    4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,
    5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,
    8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,
    11,11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,
    16,16,16,16,17,17,17,17,17,18,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,21,22,22,22,
    23,23,23,23,24,24,24,24,25,25,25,26,26,26,27,27,27,28,28,28,28,29,29,30,30,30,31,31,31,32,
    32,32,33,33,34,34,34,35,35,36,36,36,37,37,38,38,39,39,40,40,40,41,41,42,42,43,43,44,44,45,
    45,46,47,47,48,48,49,49,50,50,51,52,52,53,53,54,55,55,56,57,57,58,59,59,60,61,61,62,63,64,
    64,65,66,67,67,68,69,70,71,72,72,73,74,75,76,77,78,78,79,80,81,82,83,84,85,86,87,88,89,90,
    91,92,93,94,96,97,98,99,100,101,102,104,105,106,107,108,110,111,112,114,115,116,118,119,120,122,123,125,126,128,
    129,131,132,134,135,137,138,140,142,143,145,147,148,150,152,153,155,157,159,161,163,164,166,168,170,172,174,176,178,180,
    182,185,187,189,191,193,196,198,200,202,205,207,210,212,214,217,219,222,225,227,230,233,235,238,241,243,246,249,252,255,
    258,261,264,267,270,273,276,280,283,286,289,293,296,300,303,307,310,314,317,321,325,329,332,336,340,344,348,352,356,360,
    365,369,373,377,382,386,391,395,400,404,409,414,419,423,428,433,438,443,449,454,459,464,470,475,481,486,492,498,503,509,
    515,521,527,533,539,546,552,558,565,571,578,585,592,598,605,612,619,627,634,641,649,656,664,671,679,687,695,703,711,720,
    728,736,745,753,762,771,780,789,798,807,817,826,836,845,855,865,875,885,896,906,916,927,938,949,960,971,982,993,1005,1017,
    1028,1040,1052,1065,1077,1089,1102,1115,1128,1141,1154,1167,1181,1194,1208,1222,1236,1251,1265,1280,1295,1310,1325,1340,1356,1372,1387,1403,1420,1436,
    1453,1470,1487,1504,1521,1539,1557,1575,1593,1611,1630,1649,1668,1687,1707,1727,1747,1767,1787,1808,1829,1850,1872,1893,1915,1938,1960,1983,2006,2029,
    2052,2076,2100,2125,2149,2174,2199,2225,2250,2276,2303,2330,2357,2384,2411,2439,2468,2496,2525,2554,2584,2614,2644,2675,2706,2737,2769,2801,2833,2866,
    2899,2933,2967,3001,3036,3071,3107,3143,3179,3216,3253,3291,3329,3367,3406,3446,3486,3526,3567,3608,3650,3692,3735,3778,3822,3866,3911,3956,4002,4049,
    4096,4143,4191,4239,4289,4338,4388,4439,4491,4543,4595,4649,4702,4757,4812,4868,4924,4981,5039,5097,5156,5216,5276,5337,5399,5462,5525,5589,5654,5719,
    5785,5852,5920,5989,6058,6128,6199,6271,6343,6417,6491,6566,6642,6719,6797,6876,6956,7036,7118,7200,7283,7368,7453,7539,7627,7715,7804,7895,7986,8079,
    8172,8267,8362,8459,8557,8656,8757,8858,8961,9064,9169,9275,9383,9492,9601,9713,9825,9939,10054,10170,10288,10407,10528,10650,10773,10898,11024,11152,11281,11411,
    11544,11677,11812,11949,12088,12228,12369,12512,12657,12804,12952,13102,13254,13407,13563,13720,13879,14039,14202,14366,14533,14701,14871,15043,15218,15394,15572,15752,15935,16119,
    16306,16495,16686,16879,17074,17272,17472,17675,17879,18086,18296,18508,18722,18939,19158,19380,19604,19831,20061,20293,20528,20766,21006,21250,21496,21745,21996,22251,22509,22769,
    23033,23300,23570,23842,24119,24398,24680,24966,25255,25548,25844,26143,26445,26752,27062,27375,27692,28013,28337,28665,28997,29333,29672,30016,30364,30715,31071,31431,31795,32163,32535};



LOCAL CONST int16_t GextractByTwoTable[901] = {//%4096πÈ“ªªØ
    64,65,65,66,66,66,67,67,67,68,68,69,69,69,70,70,71,71,72,72,72,73,73,74,74,74,75,75,76,76,
    77,77,78,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85,86,86,87,87,88,88,89,89,90,90,91,
    91,92,92,93,93,94,94,95,96,96,97,97,98,98,99,99,100,101,101,102,102,103,104,104,105,105,106,107,107,108,
    108,109,110,110,111,112,112,113,114,114,115,116,116,117,118,118,119,120,120,121,122,122,123,124,125,125,126,127,128,128,
    129,130,131,131,132,133,134,134,135,136,137,137,138,139,140,141,142,142,143,144,145,146,147,147,148,149,150,151,152,153,
    153,154,155,156,157,158,159,160,161,162,163,164,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,
    182,184,185,186,187,188,189,190,191,192,193,194,196,197,198,199,200,201,202,204,205,206,207,208,210,211,212,213,214,216,
    217,218,219,221,222,223,225,226,227,229,230,231,233,234,235,237,238,239,241,242,243,245,246,248,249,251,252,254,255,256,
    258,259,261,262,264,265,267,269,270,272,273,275,276,278,280,281,283,285,286,288,289,291,293,295,296,298,300,301,303,305,
    307,308,310,312,314,316,317,319,321,323,325,327,329,331,332,334,336,338,340,342,344,346,348,350,352,354,356,358,360,362,
    365,367,369,371,373,375,377,380,382,384,386,388,391,393,395,397,400,402,404,407,409,411,414,416,419,421,423,426,428,431,
    433,436,438,441,443,446,449,451,454,456,459,462,464,467,470,472,475,478,481,484,486,489,492,495,498,501,503,506,509,512,
    515,518,521,524,527,530,533,536,539,543,546,549,552,555,558,562,565,568,571,575,578,581,585,588,592,595,598,602,605,609,
    612,616,619,623,627,630,634,638,641,645,649,652,656,660,664,668,671,675,679,683,687,691,695,699,703,707,711,715,720,724,
    728,732,736,741,745,749,753,758,762,767,771,775,780,784,789,794,798,803,807,812,817,821,826,831,836,841,845,850,855,860,
    865,870,875,880,885,890,896,901,906,911,916,922,927,932,938,943,949,954,960,965,971,976,982,988,993,999,1005,1011,1017,1022,
    1028,1034,1040,1046,1052,1058,1065,1071,1077,1083,1089,1096,1102,1108,1115,1121,1128,1134,1141,1147,1154,1161,1167,1174,1181,1188,1194,1201,1208,1215,
    1222,1229,1236,1244,1251,1258,1265,1273,1280,1287,1295,1302,1310,1317,1325,1333,1340,1348,1356,1364,1372,1379,1387,1395,1403,1412,1420,1428,1436,1444,
    1453,1461,1470,1478,1487,1495,1504,1513,1521,1530,1539,1548,1557,1566,1575,1584,1593,1602,1611,1621,1630,1640,1649,1659,1668,1678,1687,1697,1707,1717,
    1727,1737,1747,1757,1767,1777,1787,1798,1808,1819,1829,1840,1850,1861,1872,1883,1893,1904,1915,1926,1938,1949,1960,1971,1983,1994,2006,2017,2029,2041,
    2052,2064,2076,2088,2100,2112,2125,2137,2149,2162,2174,2187,2199,2212,2225,2237,2250,2263,2276,2290,2303,2316,2330,2343,2357,2370,2384,2398,2411,2425,
    2439,2453,2468,2482,2496,2511,2525,2540,2554,2569,2584,2599,2614,2629,2644,2659,2675,2690,2706,2721,2737,2753,2769,2785,2801,2817,2833,2850,2866,2883,
    2899,2916,2933,2950,2967,2984,3001,3018,3036,3053,3071,3089,3107,3125,3143,3161,3179,3197,3216,3234,3253,3272,3291,3310,3329,3348,3367,3387,3406,3426,
    3446,3466,3486,3506,3526,3546,3567,3588,3608,3629,3650,3671,3692,3714,3735,3757,3778,3800,3822,3844,3866,3889,3911,3934,3956,3979,4002,4025,4049,4072,
    4096,4119,4143,4167,4191,4215,4239,4264,4289,4313,4338,4363,4388,4414,4439,4465,4491,4517,4543,4569,4595,4622,4649,4675,4702,4729,4757,4784,4812,4840,
    4868,4896,4924,4952,4981,5010,5039,5068,5097,5126,5156,5186,5216,5246,5276,5307,5337,5368,5399,5430,5462,5493,5525,5557,5589,5621,5654,5686,5719,5752,
    5785,5819,5852,5886,5920,5954,5989,6023,6058,6093,6128,6163,6199,6235,6271,6307,6343,6380,6417,6454,6491,6529,6566,6604,6642,6681,6719,6758,6797,6836,
    6876,6916,6956,6996,7036,7077,7118,7159,7200,7242,7283,7325,7368,7410,7453,7496,7539,7583,7627,7671,7715,7759,7804,7849,7895,7940,7986,8032,8079,8125,
    8172,8219,8267,8314,8362,8411,8459,8508,8557,8607,8656,8706,8757,8807,8858,8909,8961,9012,9064,9117,9169,9222,9275,9329,9383,9437,9492,9546,9601,9657,
    9713,9769,9825,9882,9939,9996,10054,10112,10170,10229,10288,10348,10407,10467,10528,10589,10650,10711,10773,10835,10898,10961,11024,11088,11152,11216,11281,11346,11411,11477,11544};


LOCAL CONST int16_t GextractByFourTable[901] = {//%4096πÈ“ªªØ
    515,517,518,520,521,523,524,526,527,529,530,532,533,535,536,538,539,541,543,544,546,547,549,550,552,554,555,557,558,560,
    562,563,565,567,568,570,571,573,575,576,578,580,581,583,585,586,588,590,592,593,595,597,598,600,602,604,605,607,609,611,
    612,614,616,618,619,621,623,625,627,628,630,632,634,636,638,639,641,643,645,647,649,651,652,654,656,658,660,662,664,666,
    668,670,671,673,675,677,679,681,683,685,687,689,691,693,695,697,699,701,703,705,707,709,711,713,715,717,720,722,724,726,
    728,730,732,734,736,738,741,743,745,747,749,751,753,756,758,760,762,764,767,769,771,773,775,778,780,782,784,787,789,791,
    794,796,798,800,803,805,807,810,812,814,817,819,821,824,826,829,831,833,836,838,841,843,845,848,850,853,855,858,860,863,
    865,868,870,873,875,878,880,883,885,888,890,893,896,898,901,903,906,909,911,914,916,919,922,924,927,930,932,935,938,941,
    943,946,949,951,954,957,960,962,965,968,971,974,976,979,982,985,988,991,993,996,999,1002,1005,1008,1011,1014,1017,1020,1022,1025,
    1028,1031,1034,1037,1040,1043,1046,1049,1052,1055,1058,1061,1065,1068,1071,1074,1077,1080,1083,1086,1089,1092,1096,1099,1102,1105,1108,1112,1115,1118,
    1121,1124,1128,1131,1134,1137,1141,1144,1147,1151,1154,1157,1161,1164,1167,1171,1174,1177,1181,1184,1188,1191,1194,1198,1201,1205,1208,1212,1215,1219,
    1222,1226,1229,1233,1236,1240,1244,1247,1251,1254,1258,1262,1265,1269,1273,1276,1280,1284,1287,1291,1295,1299,1302,1306,1310,1314,1317,1321,1325,1329,
    1333,1336,1340,1344,1348,1352,1356,1360,1364,1368,1372,1375,1379,1383,1387,1391,1395,1399,1403,1408,1412,1416,1420,1424,1428,1432,1436,1440,1444,1449,
    1453,1457,1461,1465,1470,1474,1478,1482,1487,1491,1495,1500,1504,1508,1513,1517,1521,1526,1530,1535,1539,1543,1548,1552,1557,1561,1566,1570,1575,1579,
    1584,1588,1593,1598,1602,1607,1611,1616,1621,1625,1630,1635,1640,1644,1649,1654,1659,1663,1668,1673,1678,1683,1687,1692,1697,1702,1707,1712,1717,1722,
    1727,1732,1737,1742,1747,1752,1757,1762,1767,1772,1777,1782,1787,1793,1798,1803,1808,1813,1819,1824,1829,1834,1840,1845,1850,1856,1861,1866,1872,1877,
    1883,1888,1893,1899,1904,1910,1915,1921,1926,1932,1938,1943,1949,1954,1960,1966,1971,1977,1983,1988,1994,2000,2006,2011,2017,2023,2029,2035,2041,2046,
    2052,2058,2064,2070,2076,2082,2088,2094,2100,2106,2112,2118,2125,2131,2137,2143,2149,2155,2162,2168,2174,2180,2187,2193,2199,2206,2212,2218,2225,2231,
    2237,2244,2250,2257,2263,2270,2276,2283,2290,2296,2303,2309,2316,2323,2330,2336,2343,2350,2357,2363,2370,2377,2384,2391,2398,2404,2411,2418,2425,2432,
    2439,2446,2453,2460,2468,2475,2482,2489,2496,2503,2511,2518,2525,2532,2540,2547,2554,2562,2569,2576,2584,2591,2599,2606,2614,2621,2629,2636,2644,2652,
    2659,2667,2675,2682,2690,2698,2706,2714,2721,2729,2737,2745,2753,2761,2769,2777,2785,2793,2801,2809,2817,2825,2833,2841,2850,2858,2866,2874,2883,2891,
    2899,2908,2916,2924,2933,2941,2950,2958,2967,2975,2984,2993,3001,3010,3018,3027,3036,3045,3053,3062,3071,3080,3089,3098,3107,3116,3125,3134,3143,3152,
    3161,3170,3179,3188,3197,3207,3216,3225,3234,3244,3253,3262,3272,3281,3291,3300,3310,3319,3329,3338,3348,3358,3367,3377,3387,3397,3406,3416,3426,3436,
    3446,3456,3466,3476,3486,3496,3506,3516,3526,3536,3546,3557,3567,3577,3588,3598,3608,3619,3629,3640,3650,3661,3671,3682,3692,3703,3714,3724,3735,3746,
    3757,3767,3778,3789,3800,3811,3822,3833,3844,3855,3866,3878,3889,3900,3911,3922,3934,3945,3956,3968,3979,3991,4002,4014,4025,4037,4049,4060,4072,4084,
    4096,4107,4119,4131,4143,4155,4167,4179,4191,4203,4215,4227,4239,4252,4264,4276,4289,4301,4313,4326,4338,4351,4363,4376,4388,4401,4414,4427,4439,4452,
    4465,4478,4491,4504,4517,4530,4543,4556,4569,4582,4595,4609,4622,4635,4649,4662,4675,4689,4702,4716,4729,4743,4757,4771,4784,4798,4812,4826,4840,4854,
    4868,4882,4896,4910,4924,4938,4952,4967,4981,4995,5010,5024,5039,5053,5068,5082,5097,5112,5126,5141,5156,5171,5186,5201,5216,5231,5246,5261,5276,5291,
    5307,5322,5337,5353,5368,5384,5399,5415,5430,5446,5462,5477,5493,5509,5525,5541,5557,5573,5589,5605,5621,5637,5654,5670,5686,5703,5719,5736,5752,5769,
    5785,5802,5819,5835,5852,5869,5886,5903,5920,5937,5954,5971,5989,6006,6023,6041,6058,6075,6093,6110,6128,6146,6163,6181,6199,6217,6235,6253,6271,6289,
    6307,6325,6343,6362,6380,6398,6417,6435,6454,6473,6491,6510,6529,6548,6566,6585,6604,6623,6642,6662,6681,6700,6719,6739,6758,6778,6797,6817,6836,6856,
    6876};

#if 0
LOCAL CONST int16_t BaseGTable[901] = {//%16384πÈ“ªªØ
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,
    2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
    2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,
    4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,
    5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,8,8,
    8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,
    11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,16,16,
    16,16,16,16,17,17,17,17,17,18,18,18,18,19,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,
    23,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,28,28,28,29,29,29,30,30,30,31,31,31,32,
    32,33,33,33,34,34,35,35,35,36,36,37,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,
    46,46,47,47,48,48,49,50,50,51,51,52,53,53,54,54,55,56,56,57,58,58,59,60,60,61,62,63,63,64,
    65,65,66,67,68,69,69,70,71,72,73,74,74,75,76,77,78,79,80,81,82,83,84,85,85,86,87,89,90,91,
    92,93,94,95,96,97,98,99,101,102,103,104,105,107,108,109,110,112,113,114,115,117,118,120,121,122,124,125,127,128,
    130,131,133,134,136,137,139,141,142,144,146,147,149,151,152,154,156,158,160,161,163,165,167,169,171,173,175,177,179,181,
    183,185,188,190,192,194,196,199,201,203,206,208,211,213,215,218,221,223,226,228,231,234,236,239,242,245,247,250,253,256,
    259,262,265,268,271,275,278,281,284,288,291,294,298,301,305,308,312,315,319,323,326,330,334,338,342,346,350,354,358,362,
    366,371,375,379,384,388,393,397,402,406,411,416,421,426,430,435,440,446,451,456,461,467,472,477,483,489,494,500,506,512,
    518,524,530,536,542,548,555,561,568,574,581,588,594,601,608,615,622,630,637,644,652,659,667,675,682,690,698,707,715,723,
    731,740,748,757,766,775,784,793,802,811,821,830,840,850,859,869,879,890,900,910,921,932,942,953,964,975,987,998,1010,1021,
    1033,1045,1057,1070,1082,1095,1107,1120,1133,1146,1159,1173,1186,1200,1214,1228,1242,1257,1271,1286,1301,1316,1331,1347,1362,1378,1394,1410,1426,1443,
    1460,1477,1494,1511,1529,1546,1564,1582,1601,1619,1638,1657,1676,1695,1715,1735,1755,1775,1796,1817,1838,1859,1881,1902,1924,1947,1969,1992,2015,2039,
    2062,2086,2110,2135,2159,2184,2210,2235,2261,2287,2314,2341,2368,2395,2423,2451,2479,2508,2537,2566,2596,2626,2657,2687,2719,2750,2782,2814,2847,2880,
    2913,2947,2981,3015,3050,3086,3121,3158,3194,3231,3269,3306,3345,3383,3423,3462,3502,3543,3584,3625,3667,3710,3753,3796,3840,3885,3930,3975,4021,4068,
    4115,4163,4211,4260,4309,4359,4409,4460,4512,4564,4617,4671,4725,4779,4835,4891,4947,5005,5063,5121,5181,5241,5301,5363,5425,5488,5551,5615,5680,5746,
    5813,5880,5948,6017,6087,6157,6229,6301,6374,6447,6522,6598,6674,6751,6829,6909,6989,7070,7151,7234,7318,7403,7488,7575,7663,7752,7841,7932,8024,8117,
    8211,8306,8402,8500,8598,8698,8798,8900,9003,9107,9213,9320,9428,9537,9647,9759,9872,9986,10102,10219,10337,10457,10578,10700,10824,10950,11076,11205,11334,11466,
    11598,11733,11869,12006,12145,12286,12428,12572,12718,12865,13014,13164,13317,13471,13627,13785,13945,14106,14269,14435,14602,14771,14942,15115,15290,15467,15646,15827,16011,16196,
    16384,16573,16765,16959,17156,17354,17555,17759,17964,18172,18383,18596,18811,19029,19249,19472,19697,19925,20156,20390,20626,20865,21106,21351,21598,21848,22101,22357,22616,22878,
    23143,23410,23682,23956,24233,24514,24798,25085,25375,25669,25966,26267,26571,26879,27190,27505,27824,28146,28472,28801,29135,29472,29813,30159,30508,30861,31219,31580,31946,32316,
    32690};

#endif

LOCAL CONST int16_t BaseGTable[901] = {//%32768πÈ“ªªØ
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,
2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,
4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,
5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,
8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,11,11,11,11,
11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,16,16,
16,16,16,17,17,17,17,17,18,18,18,18,18,19,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,
23,23,23,24,24,24,24,25,25,25,26,26,26,26,27,27,27,28,28,28,29,29,29,30,30,30,31,31,32,32,
32,33,33,33,34,34,35,35,35,36,36,37,37,38,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,
46,46,47,47,48,49,49,50,50,51,51,52,53,53,54,55,55,56,56,57,58,58,59,60,61,61,62,63,63,64,
65,66,66,67,68,69,70,70,71,72,73,74,75,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,
92,93,94,95,96,97,98,100,101,102,103,104,106,107,108,109,111,112,113,114,116,117,118,120,121,123,124,126,127,128,
130,131,133,135,136,138,139,141,143,144,146,148,149,151,153,155,156,158,160,162,164,166,168,170,171,173,175,178,180,182,
184,186,188,190,192,195,197,199,202,204,206,209,211,214,216,219,221,224,226,229,231,234,237,240,242,245,248,251,254,257,
260,263,266,269,272,275,278,282,285,288,292,295,298,302,305,309,312,316,320,323,327,331,335,339,343,347,351,355,359,363,
367,371,376,380,384,389,393,398,403,407,412,417,422,427,431,436,442,447,452,457,462,468,473,479,484,490,495,501,507,513,
519,525,531,537,543,550,556,562,569,576,582,589,596,603,610,617,624,631,638,646,653,661,669,676,684,692,700,708,716,725,
733,742,750,759,768,777,786,795,804,813,823,832,842,852,861,871,881,892,902,912,923,934,945,955,967,978,989,1001,1012,1024,
1036,1048,1060,1072,1085,1097,1110,1123,1136,1149,1162,1176,1189,1203,1217,1231,1245,1260,1274,1289,1304,1319,1334,1350,1365,1381,1397,1414,1430,1446,
1463,1480,1497,1515,1532,1550,1568,1586,1604,1623,1642,1661,1680,1700,1719,1739,1759,1780,1800,1821,1842,1864,1885,1907,1929,1951,1974,1997,2020,2043,
2067,2091,2115,2140,2164,2190,2215,2241,2266,2293,2319,2346,2373,2401,2429,2457,2485,2514,2543,2573,2602,2632,2663,2694,2725,2757,2789,2821,2853,2887,
2920,2954,2988,3023,3058,3093,3129,3165,3202,3239,3276,3314,3353,3391,3431,3470,3511,3551,3592,3634,3676,3719,3762,3805,3849,3894,3939,3985,4031,4078,
4125,4173,4221,4270,4319,4369,4420,4471,4523,4575,4628,4682,4736,4791,4846,4902,4959,5017,5075,5133,5193,5253,5314,5375,5438,5501,5564,5629,5694,5760,
5827,5894,5962,6031,6101,6172,6243,6316,6389,6463,6538,6613,6690,6767,6846,6925,7005,7086,7168,7251,7335,7420,7506,7593,7681,7770,7860,7951,8043,8136,
8230,8326,8422,8520,8618,8718,8819,8921,9025,9129,9235,9342,9450,9559,9670,9782,9895,10010,10126,10243,10362,10482,10603,10726,10850,10976,11103,11231,11361,11493,
11626,11761,11897,12035,12174,12315,12458,12602,12748,12895,13045,13196,13349,13503,13659,13818,13978,14140,14303,14469,14636,14806,14977,15151,15326,15504,15683,15865,16049,16234,
16422,16613,16805,17000,17196,17396,17597,17801,18007,18215,18426,18640,18856,19074,19295,19518,19744,19973,20204,20438,20675,20914,21156,21401,21649,21900,22153,22410,22669,22932,
23197,23466,23738,24013,24291,24572,24857,25144,25436,25730,26028,26329,26634,26943,27255,27570,27890,28213,28539,28870,29204,29542,29884,30230,30580,30934,31293,31655,32022,32392,
32767};

int32_t do_sprddiv64(int64_t dividend,int32_t divisor)    //jian.chen add
{
	if(0 == divisor){
		// printk(KERN_ERR "filter_calc.c do_sprddiv64 divisor==0!\n");
		return ENODATA;
	}
	return  0;//(int32_t)div_s64(dividend,divisor);
}

/*****************************************************************************/
//! \brief  Description:  This function is to caculate eq paras.
//! \author Author:  cherry.liu
/*****************************************************************************/
BOOLEAN Filter_CalcEqCoeffs(
	int16_t  fo,                       //central freq in Hz      , nv
	int16_t  q,                        //fo/df *512 , nv
	int16_t  boostdB,                 //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
    int16_t  basegaindB,              //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
	int32_t  fs,                      //samplerate in Hz
	IIR_FILTER_PARA_T* filterPara  //out ptr,filter paras a,b
)
{
    int16_t df=0;
    int16_t Qdf=0,Qfo=0;
    int16_t qkdB=0,qkTableIndex=0,Qk=0;
    int16_t Qgama=0;
    int16_t qMin=0;
    int16_t basegain_Index=0,base_gain=0;
    int32_t df_temp=0;




    //SCI_TRACE_LOW("eq_calc.c,[Filter_CalcCoeffs] fo:%d,base_gain:%d,q:%d,boostdB:%d,fs:%d",
            //fo,base_gain,q,boostdB,fs);

    //check fo
    if(fo>=(fs>>1))
    {
        return FALSE;
    }
    else if(fo<=0)
    {
        return FALSE;
    }

    //check q
    qMin = 1113*fo/fs+1;
    if (q<qMin)
        q=qMin;


    //df = floor((fo*512)/Q);
    df = (fo<<9)/q;

    //Qdf  = floor(df*8192/Fs);
    //Qfo  = floor(fo*8192/Fs);
    Qdf  = (df<<13)/fs;
    Qfo  = (fo<<13)/fs;



    //qk = K^(0.5); Qk = qk*4096;
    if((boostdB<-720)||
        (boostdB>180))
        return FALSE;

    qkdB          =  boostdB*5;
    qkTableIndex  = (qkdB + 7200)/5 ;
    Qk            =  Linear_gain_Table[qkTableIndex]; //4096πÈ“ªªØ ;

    //gama = tan(bw/2);
    if((Qdf/2)>=2048)
		return FALSE;
    Qgama = ((cos_Table[2048-Qdf/2])<<12)/cos_Table[Qdf/2];//4096πÈ“ªªØ

    //base gain
    if((basegaindB<-720)||
        (basegaindB>180))
        return FALSE;
    basegain_Index  =  (basegaindB*10 + 7200)/5 ;
    base_gain       =  Linear_gain_Table[basegain_Index];

    //filter coefficients
    //eq_b =  [(1+gama*qk)/(1+gama/qk)   (-2*cos(w0))/(1+gama/qk)   (1-gama*qk)/(1+gama/qk)];// [b0 b1 b2]
    //eq_a =  [        1                 (-2*cos(w0))/(1+gama/qk)  (1-gama/qk)/(1+gama/qk)]; // [1 a1 a2]

    //-8192 πÈ“ªªØ /4 (finally -2048πÈ“ªªØ)

    //filterPara->B0  filterPara->A0
    df_temp = -((1<<13)*Qk + (Qgama*((Qk*Qk)>>11)))/(Qk+Qgama);
    df_temp = (df_temp*base_gain)>>(12+EQ_SCALE_FACTOR);// /4096>>EQ_SCALE_FACTOR (divide 4 to prevent overflow)

	if(df_temp>32767)
        df_temp =32767;
	if(df_temp<-32767)
        df_temp =-32767;

    filterPara->B0 = df_temp;

    filterPara->A0 = -8192;

    //filterPara->A1 filterPara->B1
    if(Qfo <= 2048)
        df_temp = cos_Table[Qfo]*Qk/(Qk + Qgama);
    else if(Qfo<=4096)
        df_temp = -cos_Table[4096-Qfo]*Qk/(Qk + Qgama);
    else
        return FALSE;

    filterPara->A1 = df_temp;

    df_temp = (df_temp*base_gain)>>(12+EQ_SCALE_FACTOR);
	if(df_temp>32767)
        df_temp =32767;
	if(df_temp<-32767)
        df_temp =-32767;

    filterPara->B1 = df_temp;

     //filterPara->B2 filterPara->A2
    df_temp = -((1<<13)*Qk - (Qgama*((Qk*Qk)>>11)))/(Qk+Qgama);
    df_temp = (df_temp*base_gain)>>(12+EQ_SCALE_FACTOR);

	if(df_temp>32767)
        df_temp =32767;
	if(df_temp<-32767)
        df_temp =-32767;

    filterPara->B2 = df_temp;

    filterPara->A2 = -((Qk - Qgama)<<13)/(Qgama + Qk);

    return TRUE;

}


/*****************************************************************************/
//! \brief  Description:  This function is to caculate f1f1 filter paras.
//! \author Author:  cherry.liu
/*****************************************************************************/
BOOLEAN Filter_CalcF1f1Coeffs(
		int16_t  f1_g0_dB,                //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
		int16_t  f1_g1_dB,                //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
		int16_t  f1_fp,                   // in Hz
		int16_t  f2_g0_dB,                //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
		int16_t  f2_g1_dB,                //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
		int16_t  f2_fp,                   // in Hz
		int32_t  fs,                      //samplerate in Hz
		IIR_FILTER_PARA_T* filterPara   //out ptr,filter paras a,b

)
{
    int16_t Qf1fp=0,Qf2fp=0;
    int16_t F1_wp_Q=0,F2_wp_Q=0;
    int16_t F1_G0_Q=0,F1_G1_Q=0,F2_G0_Q=0,F2_G1_Q=0;
    int16_t gain_index = 0;

    int32_t hsb_Q12_b0 = 0,hsb_Q12_b1 = 0,hsb_Q12_b2 = 0;
    int32_t hsa_Q12_a0 = 0,hsa_Q12_a1 = 0,hsa_Q12_a2 = 0;

    int32_t dividor=0;

    int32_t hpf_b0 = 0, hpf_b1 = 0, hpf_b2 = 0;
    int32_t hpf_a0 = 0, hpf_a1 = 0, hpf_a2 = 0;

	//check fs
	if(fs<=0)
		return FALSE;

	//Qf1fp  = floor(F1_Fp*8192/Fs)  %redefinition
	//Qf2fp  = floor(F2_Fp*8192/Fs)  %redefinition
	Qf1fp = (f1_fp<<13)/fs;
    if((Qf1fp/2)>=2048)
		return FALSE;

	Qf2fp = (f2_fp<<13)/fs;
    if((Qf2fp/2)>=2048)
		return FALSE;

	//F1_wp_Q = floor(cosTable2(2048-floor(Qf1fp/2)+1)*4096/cosTable2(floor(Qf1fp/2)+1));%4096πÈ“ªªØ
	//F2_wp_Q = floor(cosTable2(2048-floor(Qf2fp/2)+1)*4096/cosTable2(floor(Qf2fp/2)+1));%4096πÈ“ªªØ
	F1_wp_Q = ((cos_Table[2048-Qf1fp/2])<<12)/cos_Table[Qf1fp/2];//4096πÈ“ªªØ
	F2_wp_Q = ((cos_Table[2048-Qf2fp/2])<<12)/cos_Table[Qf2fp/2];//4096πÈ“ªªØ

	gain_index  =  (f1_g0_dB*10 + 7200)/5;
	F1_G0_Q     = Linear_gain_Table[gain_index];

	gain_index  =  (f1_g1_dB*10 + 7200)/5 ;
	F1_G1_Q     = Linear_gain_Table[gain_index];

	gain_index  =  (f2_g0_dB*10 + 7200)/5 ;
	F2_G0_Q     = Linear_gain_Table[gain_index];

	gain_index  =  (f2_g1_dB*10 + 7200)/5;
	F2_G1_Q     = Linear_gain_Table[gain_index];

	//hsb q=12
	hsb_Q12_b0 = F1_G1_Q*F2_G1_Q;
	hsb_Q12_b1 = (((F1_G0_Q*F1_wp_Q)>>12)*F2_G1_Q) + (((F2_G0_Q*F2_wp_Q)>>12)*F1_G1_Q);
	hsb_Q12_b2 = ((F1_G0_Q*F1_wp_Q)>>12)*((F2_G0_Q*F2_wp_Q)>>12);

	//hsa q=12
	hsa_Q12_a0 = (1<<24);
	hsa_Q12_a1 = (F1_wp_Q + F2_wp_Q)<<12;
	hsa_Q12_a2 = F1_wp_Q*F2_wp_Q;

	//dividor
	dividor  = (hsa_Q12_a0 + hsa_Q12_a1 + hsa_Q12_a2)>>12;

	//hpf q=12
	hpf_b0 = (hsb_Q12_b0 + hsb_Q12_b1 + hsb_Q12_b2)/dividor;
	if (hpf_b0>32767)
		hpf_b0 = 32767;
	else if(hpf_b0<-32767)
		hpf_b0 = -32767;

	hpf_b1 = ((hsb_Q12_b2 - hsb_Q12_b0)<<1)/dividor;
	if (hpf_b1>32767)
		hpf_b1 = 32767;
	else if(hpf_b1<-32767)
		hpf_b1 = -32767;

	hpf_b2 = (hsb_Q12_b0 - hsb_Q12_b1 + hsb_Q12_b2)/dividor;
	if (hpf_b2>32767)
		hpf_b2 = 32767;
	else if(hpf_b2<-32767)
		hpf_b2 = -32767;


	hpf_a0 = 4096;
	hpf_a1 = ((hsa_Q12_a2 - hsa_Q12_a0)<<1)/dividor;
	hpf_a2 = (hsa_Q12_a0 - hsa_Q12_a1 + hsa_Q12_a2)/dividor;

    //
    filterPara->B0 = hpf_b0;
    filterPara->B1 = hpf_b1;
    filterPara->B2 = hpf_b2;

    filterPara->A0 =  hpf_a0;
    filterPara->A1 =  hpf_a1;
    filterPara->A2 =  hpf_a2;

    return TRUE;

}

/*****************************************************************************/
//! \brief  Description:  This function is to caculate eq paras and output hpf para set.
//! \author Author:  cherry.liu
/*****************************************************************************/
BOOLEAN Filter_CalcEQ(
    FILTER_EQ_CALC_PARA_T* eq_input_para_ptr,//IN
	int32_t  fs,  //IN
    IIR_FILTER_PARA_T* filterPara ,//OUT
    int16_t*   sGain//OUT
)
{
    int16_t df=0;
    int16_t Qdf=0,Qfo=0;
    int16_t qkdB=0,qkTableIndex=0,Qk=0;
    int16_t Qgama=0;
    int16_t qMin=0;
    int16_t basegain_Index=0,base_gain=0;
    int32_t B0=0,B1=0,B2=0,S=0;
    int32_t A0=0,A1=0,A2=0;
    int32_t m=0,n_bit=0;
	int16_t  q=0;
    int16_t  fo_next;   //for LS
    int16_t  fo_last;   //for HS
	int16_t  fo = eq_input_para_ptr->fo;
	int16_t  boostdB = eq_input_para_ptr->boostdB;
    int16_t  basegaindB = eq_input_para_ptr->basegaindB;
    FILTER_EQPARA_TYPE_E eq_type=eq_input_para_ptr->eEqParaType;
    BOOLEAN filter_sw = eq_input_para_ptr->isFilterOn;

    //SCI_TRACE_LOW("filter_calc.c,[Filter_CalcEQ] fo:%d,base_gain:%d,q:%d,boostdB:%d,fs:%d,eq_type:%d,filter_sw:%d",
            //fo,base_gain,q,boostdB,fs,eq_type,filter_sw);

    if(filter_sw)
    {
        if(FILTER_EQPARA_NORMAL_EQ == eq_type)
        {
            //get q
            q = eq_input_para_ptr->unEqPara.q;

            //check fo
            if(fo>=(fs>>1))
            {
                return FALSE;
            }
            else if(fo<=0)
            {
                return FALSE;
            }

            //check q
            qMin = 1113*fo/fs+1;
            if (q<qMin)
                q=qMin;


            //df = floor((fo*512)/Q);
            df = (fo<<9)/q;

            //Qdf  = floor(df*8192/Fs);
            //Qfo  = floor(fo*8192/Fs);
            Qdf  = (df<<13)/fs;
            Qfo  = (fo<<13)/fs;



            //qk = K^(0.5); Qk = qk*4096;
            if((boostdB<-720)||
                (boostdB>180))
                return FALSE;

            qkdB          =  boostdB*5;
            qkTableIndex  = (qkdB + 7200)/5 ;
            Qk            =  Linear_gain_Table[qkTableIndex]; //4096πÈ“ªªØ ;

            //gama = tan(bw/2);
            if((Qdf/2)>=2048)
        		return FALSE;
            Qgama = ((cos_Table[2048-Qdf/2])<<12)/cos_Table[Qdf/2];//4096πÈ“ªªØ

            //base gain
            if((basegaindB<-720)||
                (basegaindB>180))
                return FALSE;
            basegain_Index  =  (basegaindB*10 + 7200)/5 ;
            base_gain       =  Linear_gain_Table[basegain_Index];

            //filter coefficients
            //eq_b =  [(1+gama*qk)/(1+gama/qk)   (-2*cos(w0))/(1+gama/qk)   (1-gama*qk)/(1+gama/qk)];// [b0 b1 b2]
            //eq_a =  [        1                 (-2*cos(w0))/(1+gama/qk)  (1-gama/qk)/(1+gama/qk)]; // [1 a1 a2]

            //16384 πÈ“ªªØ
            //B0 A0
            //B0 = ((1<<14)*Qk + (Qgama*((Qk*Qk)>>10)))/(Qk+Qgama);
            //B0 = (1<<14)*Qk/(Qk+Qgama) + ((Qgama*Qk)/(Qk+Qgama)*Qk)>>10;
            B0 =  (1<<14)*Qk/(Qk+Qgama);
            B0 += ((Qgama*Qk)/(Qk+Qgama)*Qk)>>10;
            A0  = 16384;


            // B1 A1
            if((Qfo/2)>=2048)
    		    return FALSE;
            if(Qfo <= 2048)
                B1 = -((cos_Table[Qfo]*Qk)<<1)/(Qk + Qgama);
            else if(Qfo<=4096)
                B1 = ((cos_Table[4096-Qfo]*Qk)<<1)/(Qk + Qgama);
            else
                return FALSE;
            A1 = B1;


             //B2 A2
            //B2 = ((1<<14)*Qk - (Qgama*((Qk*Qk)>>10)))/(Qk+Qgama);
            //B2 = (1<<14)*Qk/(Qk+Qgama) - ((Qgama*Qk)/(Qk+Qgama)*Qk)>>10;
            B2 =  (1<<14)*Qk/(Qk+Qgama);
            B2 -= ((Qgama*Qk)/(Qk+Qgama)*Qk)>>10;
            A2 = ((Qk - Qgama)<<14)/(Qgama + Qk);


            //prevent B overflow
            m = filter_max(abso(B0),abso(B1));
            m = filter_max(m,abso(B2));
            n_bit = 0;
            while (m>32767)
            {
               m = m/2;
               n_bit= n_bit+1;
            }

            //calc S and adjust B
            if(0 == n_bit)
            {
                S = base_gain;
            }
            else
            {
                B0 = B0>>n_bit;
                B1 = B1>>n_bit;
                B2 = B2>>n_bit;

                S  = base_gain<<n_bit;
                if(S>32767)
                {
                    S=32767;
                }
            }

            //output paras
            *sGain          = S;
            filterPara->B0  = B0;
            filterPara->B1  = B1;
            filterPara->B2  = B2;
            filterPara->A0  = 16384;
            filterPara->A1  = A1;
            filterPara->A2  = A2;

        }
        else if(FILTER_EQPARA_LOW_SHELVE == eq_type)
        {
            fo_next = eq_input_para_ptr->unEqPara.fo_next;
            /*for future development*/
            return FALSE;
        }
        else if(FILTER_EQPARA_HIGH_SHELVE == eq_type)
        {
            fo_last = eq_input_para_ptr->unEqPara.fo_last;
            /*for future development*/
            return FALSE;
        }
        else
        {
            return FALSE;
        }

    }
    else
    {
        *sGain         = 4096;
        filterPara->B0 = 16384;
        filterPara->B1 = 0;
        filterPara->B2 = 0;
        filterPara->A0 = 16384;
        filterPara->A1 = 0;
        filterPara->A2 = 0;
    }

    return TRUE;

}



/*****************************************************************************/
//! \brief  Description:  This function is to caculate f1f1 filter paras and output hpf para set.
//! \author Author:  cherry.liu
/*****************************************************************************/
BOOLEAN Filter_CalcLCF(
    FILTER_LCF_CALC_PARA_T* lcf_input_para_ptr,//IN
    int16_t  lcf_gain,//IN ,scaled by 16384
	int32_t  fs,  //IN
    IIR_FILTER_PARA_T* filterPara ,//OUT
    int16_t*   sGain//OUT
)
{
    int32_t m=0,n_bit=0;
    int32_t hpf_b0 = 0, hpf_b1 = 0, hpf_b2 = 0,S=0;
    int32_t hpf_a0 = 0, hpf_a1 = 0, hpf_a2 = 0;
    FILTER_LCFPARA_TYPE_E lcf_type =lcf_input_para_ptr->eLcfParaType;
    BOOLEAN filter_sw   = lcf_input_para_ptr->isFilterOn;

    //%all pass filter
    *sGain          = 4096;

    filterPara->B0  = 16384;
    filterPara->B1  = 0;
    filterPara->B2  = 0;

    filterPara->A0  = 16384;
    filterPara->A1  = 0;
    filterPara->A2  = 0;

    //check fs
	if(fs<=0)
		return FALSE;

    if(filter_sw)
    {
        if(FILTER_LCFPARA_F1F1 == lcf_type)
        {
        	int16_t  f1_g0_dB = lcf_input_para_ptr->unlcfPara.lcfPara.f1_g0;
        	int16_t  f1_g1_dB = lcf_input_para_ptr->unlcfPara.lcfPara.f1_g1;
        	int16_t  f1_fp    = lcf_input_para_ptr->unlcfPara.lcfPara.f1_fp;
        	int16_t  f2_g0_dB = lcf_input_para_ptr->unlcfPara.lcfPara.f2_g0;
        	int16_t  f2_g1_dB = lcf_input_para_ptr->unlcfPara.lcfPara.f2_g1;
        	int16_t  f2_fp     = lcf_input_para_ptr->unlcfPara.lcfPara.f2_fp;
            int16_t  Qf1fp=0,Qf2fp=0;
            int32_t  F1_wp_Q=0,F2_wp_Q=0;
            int16_t  F1_G0_Q=0,F1_G1_Q=0,F2_G0_Q=0,F2_G1_Q=0;
            int16_t  gain_index = 0;
            int64_t  hsb_Q12_b0 = 0,hsb_Q12_b1 = 0,hsb_Q12_b2 = 0;
            int64_t  hsa_Q12_a0 = 0,hsa_Q12_a1 = 0,hsa_Q12_a2 = 0;
            int64_t  dividor=0;

            //check the validity of the input paras.
            if((f1_g0_dB<-720)||(f1_g0_dB>180))
                return TRUE;
            if((f1_g1_dB<-720)||(f1_g1_dB>180))
                return TRUE;
            if((f2_g0_dB<-720)||(f2_g0_dB>180))
                return TRUE;
            if((f2_g1_dB<-720)||(f2_g1_dB>180))
                return TRUE;

        	//Qf1fp  = floor(F1_Fp*8192/Fs)  %redefinition
        	//Qf2fp  = floor(F2_Fp*8192/Fs)  %redefinition
        	Qf1fp = (f1_fp<<13)/fs;
            if((Qf1fp/2)>=2048)
        		return TRUE;
        	Qf2fp = (f2_fp<<13)/fs;
            if((Qf2fp/2)>=2048)
        		return TRUE;

        	//F1_wp_Q = floor(cosTable2(2048-floor(Qf1fp/2)+1)*4096/cosTable2(floor(Qf1fp/2)+1));%4096πÈ“ªªØ
        	//F2_wp_Q = floor(cosTable2(2048-floor(Qf2fp/2)+1)*4096/cosTable2(floor(Qf2fp/2)+1));%4096πÈ“ªªØ
        	F1_wp_Q = ((cos_Table[2048-Qf1fp/2])<<12)/cos_Table[Qf1fp/2];//4096πÈ“ªªØ
        	F2_wp_Q = ((cos_Table[2048-Qf2fp/2])<<12)/cos_Table[Qf2fp/2];//4096πÈ“ªªØ

        	gain_index  =  (f1_g0_dB*10 + 7200)/5;
        	F1_G0_Q     = Linear_gain_Table[gain_index];

        	gain_index  =  (f1_g1_dB*10 + 7200)/5 ;
        	F1_G1_Q     = Linear_gain_Table[gain_index];

        	gain_index  =  (f2_g0_dB*10 + 7200)/5 ;
        	F2_G0_Q     = Linear_gain_Table[gain_index];

        	gain_index  =  (f2_g1_dB*10 + 7200)/5;
        	F2_G1_Q     = Linear_gain_Table[gain_index];

        	//hsb q=24
        	hsb_Q12_b0 = (int64_t)F1_G1_Q*F2_G1_Q;
        	hsb_Q12_b1 = ((((int64_t)F1_G0_Q*F1_wp_Q)>>12)*F2_G1_Q) + ((((int64_t)F2_G0_Q*F2_wp_Q)>>12)*F1_G1_Q);
        	hsb_Q12_b2 = (((int64_t)F1_G0_Q*F1_wp_Q)>>12)*(((int64_t)F2_G0_Q*F2_wp_Q)>>12);

        	//hsa q=24
        	hsa_Q12_a0 = (1<<24);
        	hsa_Q12_a1 = ((int64_t)F1_wp_Q + F2_wp_Q)<<12;
        	hsa_Q12_a2 = (int64_t)F1_wp_Q*F2_wp_Q;

        	//dividor q=12
        	dividor  = (hsa_Q12_a0 + hsa_Q12_a1 + hsa_Q12_a2)>>12;

        	//hpf q=14
        	hpf_b0 = (int32_t)(((hsb_Q12_b0 + hsb_Q12_b1 + hsb_Q12_b2)<<2)/dividor);
//			hpf_b0 = do_sprddiv64(((hsb_Q12_b0 + hsb_Q12_b1 + hsb_Q12_b2)<<2), dividor);
        	hpf_b1 = (int32_t)(((hsb_Q12_b2 - hsb_Q12_b0)<<3)/dividor);
//			hpf_b1 = do_sprddiv64(((hsb_Q12_b2 - hsb_Q12_b0)<<3), dividor);

        	hpf_b2 = (int32_t)(((hsb_Q12_b0 - hsb_Q12_b1 + hsb_Q12_b2)<<2)/dividor);
//			hpf_b2 = do_sprddiv64(((hsb_Q12_b0 - hsb_Q12_b1 + hsb_Q12_b2)<<2), dividor);


        	hpf_a0 = 16384;
        	hpf_a1 = (int32_t)((((hsa_Q12_a2 - hsa_Q12_a0)<<1)/dividor)<<2);
//			hpf_a1 = (do_sprddiv64(((hsa_Q12_a2 - hsa_Q12_a0)<<1), dividor))<<2;

        	hpf_a2 = (int32_t)(((hsa_Q12_a0 - hsa_Q12_a1 + hsa_Q12_a2)/dividor)<<2);
//			hpf_a2 = (do_sprddiv64((hsa_Q12_a0 - hsa_Q12_a1 + hsa_Q12_a2), dividor))<<2;


        }
        else if(FILTER_LCFPARA_BUTTERWORTH == lcf_type)
        {
            int16_t LCF_Fp = lcf_input_para_ptr->unlcfPara.fp;
            int32_t K=0,BUT_GAIN=0;
            int16_t Qlcffp=0;
            int64_t d0 = 0,d1 = 0,d2 = 0;
            int32_t Qk2dk = 0,dividor=0;

            //get K=kk*Qk
            Qlcffp  = (LCF_Fp<<13)/fs;  //%redefinition Qlcffp:[0,4096]
            if((Qlcffp/2)==0)
        		return TRUE;
            K       = ((cos_Table[Qlcffp/2])<<14)/cos_Table[2048-Qlcffp/2]; //%Qk πÈ“ªªØ  int32_t

            //get dividends and dividor
            Qk2dk = ((1<<28)/K);

            d0 = (int64_t)lcf_gain*K;
            d1 = ((int64_t)Qk2dk-K)<<15;
            d2 = ((int64_t)K - 23170 + Qk2dk)<<14;
            dividor = (K + 23170 + Qk2dk);

            //calc paras
			BUT_GAIN = (int32_t)(-d0/dividor);
			//BUT_GAIN = do_sprddiv64(-d0, dividor);
            if(BUT_GAIN==0)
                BUT_GAIN = -1;

            hpf_b0 = BUT_GAIN;
            hpf_b1 = -BUT_GAIN<<1;
            hpf_b2 = BUT_GAIN;

            hpf_a0 = 16384;
			hpf_a1 = (int32_t)(d1/dividor);
			hpf_a2 = (int32_t)(d2/dividor);
			//hpf_a1 = do_sprddiv64(d1, dividor);
			//hpf_a2 = do_sprddiv64(d2, dividor);

        }
        else
        {
            /*for future development*/
            return TRUE;
        }

        //prevent B overflow
        m = filter_max(abso(hpf_b0),abso(hpf_b1));
        m = filter_max(m,abso(hpf_b2));
        n_bit = 0;
        while (m>32767)
        {
           m = m/2;
           n_bit= n_bit+1;
        }

        //calc S and adjust B
        if(0 == n_bit)
        {
            S = 4096;
        }
        else
        {
            hpf_b0 = hpf_b0>>n_bit;
            hpf_b1 = hpf_b1>>n_bit;
            hpf_b2 = hpf_b2>>n_bit;

            S  = 4096<<n_bit;
            if(S>32767)
            {
                S=32767;
            }
        }

        //output paras
        *sGain           = S;
        filterPara->B0  = hpf_b0;
        filterPara->B1  = hpf_b1;
        filterPara->B2  = hpf_b2;
        filterPara->A0  = hpf_a0;
        filterPara->A1  = hpf_a1;
        filterPara->A2  = hpf_a2;
    }

    return TRUE;

}


/*****************************************************************************/
//! \brief  Description:  This function is to caculate eq paras and output hpf para set.
//! \author Author:  cherry.liu
//! this interface is for tool layer only
/*****************************************************************************/
BOOLEAN Filter_CalcEQ_Para(
    BOOLEAN  band_filter_on,
	int16_t    band_fo,
    int16_t    band_q,
	int16_t    band_boostdB,
    int16_t    band_basegaindB,
	int32_t    fs,
    IIR_FILTER_PARA_T* filterPara ,//OUT
    int16_t*   sGain//OUT
)
{
    FILTER_EQ_CALC_PARA_T  eq_input_para = {0};//in/IN


    eq_input_para.isFilterOn   = band_filter_on;
    eq_input_para.eEqParaType  = FILTER_EQPARA_NORMAL_EQ;
    eq_input_para.unEqPara.q   = band_q;

    eq_input_para.fo         = band_fo;
    eq_input_para.boostdB    = band_boostdB;
    eq_input_para.basegaindB = band_basegaindB;

    return Filter_CalcEQ(&eq_input_para, fs, filterPara,sGain);
}

/*****************************************************************************/
//! \brief  Description:  This function is to caculate f1f1 filter paras and output hpf para set.
//! \author Author:  cherry.liu
//! this interface is for tool layer only
/*****************************************************************************/
BOOLEAN Filter_CalcLCF_Para(
    FILTER_LCF_CALC_PARA_T* lcf_input_para_ptr,//IN
	int32_t  fs,  //IN
    IIR_FILTER_PARA_T* filterPara ,//OUT
    int16_t*   sGain//OUT
)
{
    return Filter_CalcLCF(lcf_input_para_ptr,16384,fs,filterPara,sGain);
}

/*****************************************************************************/
//! \brief  Description:  This function is to caculate eq a/b paras.
//!    it is an enhancement or extention function for Filter_CalcEqCoeffs
//! \author Author:  cherry.liu
/*****************************************************************************/
BOOLEAN Filter_CalcEqCoeffs_Ex(
	int16_t  fo,                    //central freq in Hz
	int16_t  df,                    //band width in Hz
	int16_t  boostdB,               //range -720:1:180;  (-72dB ~ 18dB ,step:0.1dB)
    int16_t  basegaindB,            //range -840:1:60;  (-84dB ~ 6dB ,step:0.1dB)
	int32_t  Fs,                    //samplerate in Hz
	IIR_FILTER_PARA_T* filterPara,  //out ptr,filter paras a,b
	int16_t*   sGain//OUT  scaled by 32768
)
{
    int16_t G0_Index=0,G1_Index=0;
    int16_t G0_fix=0,G1_fix=0,B_G_fix=0;
    int32_t EQ_B_GAIN=0;
    int32_t m=0,n_bit=0;

    int32_t B0=0,B1=0,B2=0,S=0;
    int32_t A0=0,A1=0,A2=0;

    int32_t b_dividor=0,a_dividor=0;
    int64_t b0_d=0,b1_d=0,a0_d=0,a1_d=0;

    //%all pass filter
    *sGain          = 32767;

    filterPara->B0  = 16384;
    filterPara->B1  = 0;
    filterPara->B2  = 0;

    filterPara->A0  = 16384;
    filterPara->A1  = 0;
    filterPara->A2  = 0;

    //check the validity of the input paras
	if(Fs<=0)
		return FALSE;

    if((basegaindB<-900)||(basegaindB>180))
        return TRUE;

    //%add base gain;
    if(basegaindB<=0)
    {
        G1_Index  =  basegaindB + 900;
        *sGain    =  BaseGTable[G1_Index];//%scaled by 32768  base gain
    }
    else
    {
        *sGain    = 32767; //%scaled by 32768  %base gain

        G1_Index  =  basegaindB + 720;
        B_G_fix = GTable[G1_Index];

        if(B_G_fix>=8192)
        {
            filterPara->B0  = 32767;
        }
        else
        {
            filterPara->B0 = (filterPara->B0*B_G_fix)>>12;
            filterPara->B1 = (filterPara->B1*B_G_fix)>>12;
            filterPara->B2 = (filterPara->B2*B_G_fix)>>12;
        }
    }


    if((boostdB<-720)||(boostdB>180))   // in para overflow
        return TRUE;

    if(0==boostdB)            //all pass case
        return TRUE;

    //%caculation begins
    G0_Index  =  boostdB + 720;
    G0_fix    =  GTable[G0_Index];//%scaled by 4096

    if(fo <= 0)
    {
        int16_t Fp=0;
        int16_t G0_ExTwo_fix=0,G0_ExFour_fix=0,Qeqfp=0;
        int32_t WP=0;
        int64_t WP_d=0;
        int32_t Qk2dwp = 0;

        Fp    =   df;//% 3000;         % Pole Frequency
        G0_ExTwo_fix  =  GextractByTwoTable[G0_Index];//%scaled by 4096
        G0_ExFour_fix =  GextractByFourTable[G0_Index];//%scaled by 4096

        Qeqfp  = (Fp<<13)/Fs;  //%redefinition Qeqfp:[0,4096]
        if((Qeqfp/2)>=2048) // in para overflow
		    return TRUE;
        WP_d   = (int64_t)(1<<26)*cos_Table[2048-Qeqfp/2];
        WP     = (int32_t)(WP_d/(G0_ExFour_fix*cos_Table[Qeqfp/2]));//%16384 πÈ“ªªØ  int32_t
//		WP = do_sprddiv64(WP_d, (G0_ExFour_fix*cos_Table[Qeqfp/2]));
        if(WP==0)
        {
            WP=1;
        }

        //get dividor and dividends
        Qk2dwp = ((1<<28)/WP);
        b_dividor = Qk2dwp + (((int32_t)G0_ExTwo_fix*23170)>>12) + (int32_t)(((int64_t)WP*G0_fix)>>12); //% int32_t
        a_dividor = Qk2dwp + 23170 + WP ; //% int32_t

        b0_d = (((int64_t)WP*G0_fix)<<3) -((int64_t)Qk2dwp<<15);  //% int64_t
        b1_d = (((int64_t)Qk2dwp - (((int32_t)G0_ExTwo_fix*23170)>>12) + (((int64_t)WP*G0_fix)>>12))<<14) ;  //% int64_t
        a0_d = (((int64_t)WP-Qk2dwp)<<15)  ;          //% int64_t
        a1_d = (((int64_t)Qk2dwp - 23170 + WP)<<14) ; //% int64_t

        EQ_B_GAIN = (int32_t)(((int64_t)b_dividor<<12)/a_dividor);//%scaled by 4096
//        EQ_B_GAIN = do_sprddiv64(((int64_t)b_dividor<<12), a_dividor);
    }
    else if (fo>=22050)
    {
        int16_t Fp=0;
        int16_t G0_ExTwo_fix=0,G0_ExFour_fix=0,Qeqfp=0;
        int32_t WP=0;
        int64_t WP_d=0;
        int32_t Qk2dwp = 0;

        Fp    =   df;//% 3000;         % Pole Frequency
        G0_ExTwo_fix  =  GextractByTwoTable[G0_Index];//%scaled by 4096
        G0_ExFour_fix =  GextractByFourTable[G0_Index];//%scaled by 4096

        Qeqfp  = (Fp<<13)/Fs; // %redefinition Qeqfp:[0,4096]
        if((Qeqfp/2)>=2048) // in para overflow
		    return TRUE;
        WP_d   = ((int64_t)(G0_ExFour_fix*cos_Table[2048-Qeqfp/2])<<14);
        WP     = (int32_t)(WP_d/(cos_Table[Qeqfp/2]<<12));// %16384 πÈ“ªªØ  int32_t
//		WP = do_sprddiv64(WP_d, (cos_Table[Qeqfp/2]<<12));
        if(WP==0)
        {
            WP=1;
        }

        //get dividor and dividends
        Qk2dwp = ((1<<28)/WP);
        b_dividor = (int32_t)((((int64_t)Qk2dwp*G0_fix)>>12) + (((int32_t)G0_ExTwo_fix*23170)>>12) + WP );//% int32_t
        a_dividor = Qk2dwp + 23170 + WP;//% int32_t

        b0_d = ((int64_t)(WP-(((int64_t)Qk2dwp*G0_fix)>>12))<<15);   //% int64_t
        b1_d = ((((int64_t)Qk2dwp*G0_fix)>>12) - (((int32_t)G0_ExTwo_fix*23170)>>12) + WP)<<14;   //% int64_t
        a0_d = (((int64_t)WP-Qk2dwp)<<15);   //% int64_t
        a1_d = (((int64_t)Qk2dwp - 23170 + WP)<<14);   //% int64_t

        EQ_B_GAIN = (int32_t)(((int64_t)b_dividor<<12)/a_dividor);//%scaled by 4096
//		EQ_B_GAIN = do_sprddiv64(((int64_t)b_dividor<<12), a_dividor);

    }
    else
    {
        int16_t QK=0,COSW0=0;
        int16_t Qeqbw=0,Qeqfo=0;
        int32_t GAMA=0;
        int32_t b_gain_dividor = 0;

        QK        =  GextractByTwoTable[G0_Index];//%scaled by 4096

        Qeqbw  = (df<<13)/Fs;  //%redefinition Qeqfp:[0,4096]
        if((Qeqbw/2)>=2048)
		    return TRUE;
        GAMA   = 16384*cos_Table[2048-Qeqbw/2]/cos_Table[Qeqbw/2]; //%16384 πÈ“ªªØ  int32_t

        Qeqfo  = (fo<<13)/Fs;  //%redefinition
        if((Qeqfo/2)>=2048)
		    return TRUE;
        if(Qeqfo<=2048)
            COSW0 = cos_Table[Qeqfo];//%scaled by 16384
        else
            COSW0 = -cos_Table[4096-Qeqfo];//%scaled by 16384


        b_gain_dividor = (int32_t)(16384 + ((int64_t)GAMA<<12)/QK);//%int32_t
//			b_gain_dividor = 16384 + do_sprddiv64(((int64_t)GAMA<<12), QK);

        b_dividor = (int32_t)(4096 + (((int64_t)GAMA*QK)>>14)); //%int32_t
        a_dividor = (QK<<2) + GAMA ;//%int32_t

        b0_d =  -(int64_t)COSW0<<13;        //%int64_t
        b1_d =  (int64_t)((1<<26) - (int64_t)GAMA*QK); //%int64_t
        a0_d =  -((int64_t)COSW0*QK)<<3;       //%int32_t ,for unification set it as int64_t
        a1_d =  (4*QK - (int64_t)GAMA)<<14; //%int64_t

        EQ_B_GAIN = (int32_t)(((int64_t)b_dividor<<14)/b_gain_dividor);//%scaled by 4096
//		EQ_B_GAIN = do_sprddiv64(((int64_t)b_dividor<<14), b_gain_dividor);

    }

    B0 = EQ_B_GAIN<<2;
    B1 = (int32_t)(((b0_d/b_dividor)*EQ_B_GAIN)>>12);
//	B1= (do_sprddiv64(b0_d,b_dividor)*EQ_B_GAIN)>>12;
    B2 = (int32_t)(((b1_d/b_dividor)*EQ_B_GAIN)>>12);
// 	B2= (do_sprddiv64(b1_d,b_dividor)*EQ_B_GAIN)>>12;

    A0 = 16384;
    A1 = (int32_t)(a0_d/a_dividor);
//	A1=do_sprddiv64(a0_d,a_dividor);
    A2 = (int32_t)(a1_d/a_dividor);
//	A2=do_sprddiv64(a1_d,a_dividor);


    if(basegaindB<=0)
    {
        G1_Index  =  basegaindB + 900;
        G1_fix    =  BaseGTable[G1_Index];//%scaled by 32768  base gain
    }
    else
    {
        G1_fix    = 32767; //%scaled by 32768  %base gain

        G1_Index  =  basegaindB + 720;
        B0 = (B0*GTable[G1_Index])>>12;
        B1 = (B1*GTable[G1_Index])>>12;
        B2 = (B2*GTable[G1_Index])>>12;
    }

    //%prevent B overflow
    m = filter_max(abso(B0),abso(B1));
    m = filter_max(m,abso(B2));
    n_bit = 0;

    while (m>32767)
    {
       m = m/2;
       n_bit= n_bit+1;
    }

    //calc S and adjust B
    if(0 == n_bit)
    {
        S = G1_fix;
    }
    else
    {
        B0 = B0>>n_bit;
        B1 = B1>>n_bit;
        B2 = B2>>n_bit;

        S  = G1_fix<<n_bit;
        if(S>32767)
        {
            S=32767;
        }
    }

    //output paras
    *sGain          = S;
    filterPara->B0  = B0;
    filterPara->B1  = B1;
    filterPara->B2  = B2;
    filterPara->A0  = A0;
    filterPara->A1  = A1;
    filterPara->A2  = A2;

    return TRUE;

}
/**---------------------------------------------------------------------------*
 **                         Compiler Flag                                     *
 **---------------------------------------------------------------------------*/
#ifdef   __cplusplus
    }

#endif

